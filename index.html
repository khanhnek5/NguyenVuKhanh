<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Key Free Hôm Nay</title>
<style>
  body { font-family: Arial, sans-serif; background:#f0f0f0; display:flex; justify-content:center; align-items:center; height:100vh; }
  .container { background:#fff; padding:30px; border-radius:10px; box-shadow:0 0 15px rgba(0,0,0,0.2); text-align:center; width:400px; }
  img { max-width:200px; height:auto; margin-bottom:20px; }
  h2 { margin-bottom:20px; }
  button { padding:10px 20px; margin-top:10px; cursor:pointer; border:none; background:#28a745; color:#fff; border-radius:5px; font-size:16px; }
  #countdown { margin-top:10px; color:#555; font-size:14px; }
  a { color:#007bff; text-decoration:none; margin-top:10px; display:inline-block; }
</style>
</head>
<body>
<div class="container">
  <img src="https://sf-static.upanhlaylink.com/img/image_2025103134746677a16d9e7c9ddd1cbb6ae1c575.jpg" alt="Logo">
  <h2>Key Free Hôm Nay</h2>
  <p id="key">Đang tải key...</p>
  <button id="copyBtn">Copy Key</button>
  <p id="countdown"></p>
  <a href="redirect.html">Lấy key qua shortlink (earn!)</a>  <!-- Suggest: Link đến redirect -->
</div>

<script>
async function loadKey() {
  try {
    // --- Fetch key từ GitHub Pages ---
    const res = await fetch('https://khanhnek5.github.io/NguyenVuKhanh/key_today.json?ts=' + Date.now());
    if (!res.ok) {  // Fix: Check HTTP status
      throw new Error('Fetch failed: ' + res.status);
    }
    const data = await res.json();
    const key = data.key || null;

    if(!key){
      document.getElementById('key').innerText = "Key hôm nay chưa sẵn sàng, vui lòng thử lại sau.";
      return;
    }

    document.getElementById('key').innerText = key;

    // --- Countdown hết hạn key tới 0h hôm sau ---
    const now = new Date();
    const tomorrow = new Date(now.getFullYear(), now.getMonth(), now.getDate()+1);
    function updateCountdown(){
      const diff = tomorrow - new Date();
      if(diff<=0){
        document.getElementById('countdown').innerText = "Key hết hạn!";
        return;
      }
      const h = Math.floor(diff/1000/3600);
      const m = Math.floor(diff/1000/60)%60;
      const s = Math.floor(diff/1000)%60;
      document.getElementById('countdown').innerText = `Hết hạn trong ${h}h ${m}m ${s}s`;
      setTimeout(updateCountdown,1000);
    }
    updateCountdown();

  } catch(e){
    console.log(e);
    document.getElementById('key').innerText = "Key hôm nay chưa sẵn sàng, vui lòng thử lại sau.";
  }
}

// --- Copy key ---
document.getElementById('copyBtn').addEventListener('click',()=>{
  const key = document.getElementById('key').innerText;
  if(key && key.indexOf("Key hôm nay")===-1){
    navigator.clipboard.writeText(key);
    alert("Đã copy key!");
  }
});

loadKey();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>KhanhMG â€” Key theo user</title>
<style>
  body{font-family:Inter,system-ui,Arial;background:#071022;color:#eef3f5;display:flex;align-items:center;justify-content:center;height:100vh;margin:0}
  .card{width:min(720px,94%);background:rgba(255,255,255,0.02);padding:22px;border-radius:12px}
  input,button{padding:10px;border-radius:8px;border:0}
  input{width:300px}
  .key{font-family:monospace;background:rgba(0,0,0,0.18);padding:8px 12px;border-radius:8px;display:inline-block}
  .note{color:#9aa9b2;font-size:13px}
</style>
</head>
<body>
  <div class="card">
    <h2>ğŸ” Key hÃ ng ngÃ y theo user â€” KhanhMG</h2>
    <p class="note">Nháº­p <strong>username</strong> (hoáº·c email/id). Key Ä‘á»•i má»—i 00:00 theo giá» thiáº¿t bá»‹.</p>

    <div style="display:flex;gap:8px;align-items:center;margin:12px 0">
      <input id="username" placeholder="Nháº­p username (vÃ­ dá»¥: khanh123)" />
      <button id="btnGen">Táº¡o key</button>
      <button id="btnCopy">Sao chÃ©p</button>
    </div>

    <div style="margin-top:8px">
      <div>Key: <span id="key" class="key">â€”</span></div>
      <div class="note" style="margin-top:8px">Máº«u: <code>KhanhMG-&lt;10 kÃ½ tá»±&gt;</code></div>
    </div>

    <hr style="margin:16px 0;opacity:.06" />
    <div class="note">ChÃº Ã½: náº¿u báº¡n host trang nÃ y cÃ´ng khai vÃ  Ä‘á»ƒ <code>SALT</code> á»Ÿ bÃªn trong, thÃ¬ ngÆ°á»i khÃ¡c cÃ³ thá»ƒ sinh key. Muá»‘n an toÃ n, dÃ¹ng server (Flask) giá»¯ <code>SALT</code> bÃ­ máº­t.</div>
  </div>

<script>
/*
 CLIENT-SIDE KEY ALGORITHM
 - seed = SALT + username + YYYY-MM-DD
 - hash = SHA-256(seed)
 - láº¥y 10 kÃ½ tá»± tá»« hash giá»‘ng thuáº­t toÃ¡n trÆ°á»›c (cáº·p bytes)
*/
const CHARSET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
const PREFIX = "KhanhMG-";
const KEY_LEN = 10;

// >>> Thay giÃ¡ trá»‹ SALT táº¡i Ä‘Ã¢y náº¿u muá»‘n (náº¿u host cÃ´ng khai: SALT lá»™)
// Náº¿u muá»‘n an toÃ n: Ä‘á»«ng Ä‘áº·t SALT á»Ÿ Ä‘Ã¢y. DÃ¹ng server Ä‘á»ƒ tráº£ key.
const SALT = "CHANGE_THIS_TO_SOMETHING_SECRET";

async function sha256Bytes(msg){
  const enc = new TextEncoder();
  const data = enc.encode(msg);
  const h = await crypto.subtle.digest('SHA-256', data);
  return new Uint8Array(h);
}

async function genKeyFor(username, dateObj){
  const y = dateObj.getFullYear();
  const m = String(dateObj.getMonth()+1).padStart(2,'0');
  const d = String(dateObj.getDate()).padStart(2,'0');
  const seed = SALT + username + `${y}-${m}-${d}`;
  const bytes = await sha256Bytes(seed);
  let key = "";
  for(let i=0;i<KEY_LEN;i++){
    const b1 = bytes[i % bytes.length];
    const b2 = bytes[(i + 11) % bytes.length];
    const val = ((b1 << 8) | b2) >>> 0;
    const idx = val % CHARSET.length;
    key += CHARSET.charAt(idx);
  }
  return PREFIX + key;
}

document.getElementById('btnGen').addEventListener('click', async ()=>{
  const user = (document.getElementById('username').value || "").trim();
  if(!user){ alert("Nháº­p username Ä‘Ã£."); return; }
  document.getElementById('key').textContent = "Äang táº¡o...";
  try{
    const k = await genKeyFor(user, new Date());
    document.getElementById('key').textContent = k;
  }catch(e){
    document.getElementById('key').textContent = "Lá»—i";
    console.error(e);
  }
});

document.getElementById('btnCopy').addEventListener('click', async ()=>{
  const txt = document.getElementById('key').textContent;
  if(!txt || txt === "â€”") return;
  try{ await navigator.clipboard.writeText(txt); alert("ÄÃ£ sao chÃ©p: " + txt); }
  catch(e){ alert("KhÃ´ng copy Ä‘Æ°á»£c, má»Ÿ thá»§ cÃ´ng"); }
});
</script>
</body>
</html>
